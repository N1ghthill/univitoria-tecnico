# .github/workflows/portal-school-notify.yml
name: Portal Escola Updates
on:
  push:
    branches: [ main, develop ]
    paths:
      - 'src/**'
      - 'public/**'
      - 'package.json'
      - '.github/workflows/**'   # â† LINHA ADICIONADA!
  pull_request:
    types: [opened, closed, merged]
  release:
    types: [published]

jobs:
  notify-discord:
    runs-on: ubuntu-latest
    steps:
      - name: Format Portal Message
        id: format
        run: |
          # Detecta tipo de evento
          if [ "${{ github.event_name }}" = "push" ]; then
            EMOJI="ğŸš€"
            ACTION="Nova atualizaÃ§Ã£o"
          elif [ "${{ github.event_name }}" = "pull_request" ]; then
            EMOJI="ğŸ”„"
            ACTION="Pull Request"
          elif [ "${{ github.event_name }}" = "release" ]; then
            EMOJI="ğŸ‰"
            ACTION="Nova versÃ£o"
          fi
          
          echo "emoji=$EMOJI" >> $GITHUB_OUTPUT
          echo "action=$ACTION" >> $GITHUB_OUTPUT

      - name: Send to Discord
        if: github.event_name != 'release'
        uses: appleboy/discord-action@master
        with:
          webhook_id: ${{ secrets.DISCORD_WEBHOOK_ID }}
          webhook_token: ${{ secrets.DISCORD_WEBHOOK_TOKEN }}
          message: |
            ${{ steps.format.outputs.emoji }} **PORTAL ESCOLA** - ${{ steps.format.outputs.action }}
            
            ğŸ“Œ **RepositÃ³rio:** ${{ github.event.repository.name }}
            ğŸ‘¨â€ğŸ’» **Por:** ${{ github.actor }}
            
            ${{ github.event.head_commit && format('ğŸ“ **Commit:** {0}', github.event.head_commit.message) }}
            ${{ github.event.pull_request && format('ğŸ”— **PR:** {0}', github.event.pull_request.title) }}
            
            ğŸŒ **Acessar portal:** https://n1ghthill.github.io/univitoria-tecnico/
            ğŸ”§ **Tech Stack:** React/Node.js/MySQL
            ğŸ« **Projeto:** Sistema de gestÃ£o escolar

      # NotificaÃ§Ã£o especial para releases
      - name: Send Release Details
        if: github.event_name == 'release'
        uses: appleboy/discord-action@master
        with:
          webhook_id: ${{ secrets.DISCORD_WEBHOOK_ID }}
          webhook_token: ${{ secrets.DISCORD_WEBHOOK_TOKEN }}
          message: |
            ğŸŠ **NOVA VERSÃƒO DO PORTAL ESCOLA!** ğŸŠ
            
            **VersÃ£o:** ${{ github.event.release.tag_name }}
            **Notas da versÃ£o:**
            ```
            ${{ github.event.release.body }}
            ```
            
            ğŸš€ **Novidades desta versÃ£o:**
            â€¢ Sistema de notas implementado
            â€¢ Portal do professor
            â€¢ Dashboard administrativo
            
            ğŸ“Š **Status:** âœ… Em produÃ§Ã£o
            ğŸ”— **Acessar:** https://n1ghthill.github.io/univitoria-tecnico/
